import{o as i,u as M,b as q,g as U,h as J,i as K,k as Q,n as V,p as W,e as E,m as X,j as _,l as m}from"./index-f6f0aeca.js";import{g as R,u as Y}from"./getOffsetToRoot-cb87f6b3.js";import{s as Z}from"./scrollTo-223bb6b6.js";import{t as x}from"./toPx-bd3400a3.js";const tt={anchor:"^anchor",anchor__link:"^anchor__link","anchor__link.is-active":"is-active","anchor__indicator-track":"^anchor__indicator-track","anchor__indicator-wrapper":"^anchor__indicator-wrapper","anchor__dot-indicator":"^anchor__dot-indicator","anchor__line-indicator":"^anchor__line-indicator"},I=Symbol(),N=Symbol();function et(O,b){const{styleOverrides:D,styleProvider:T,list:A,page:w,distance:l=0,scrollBehavior:$="instant",indicator:k=I,onClick:y,...v}=M("Anchor",O),d=q(tt,{anchor:T==null?void 0:T.anchor},D),{pageScrollRef:B,contentResizeRef:j}=U(),n=J(w??(()=>B.current)),f=i.useRef(null),g=i.useRef(null),C=i.useRef({}),[S,P]=i.useState(null),u=K(()=>{if(n.current&&f.current&&g.current){const s=R(n.current);let e;const r=c=>{c.forEach(({href:t,children:h})=>{const a=document.getElementById(t);if(a&&n.current){const p=R(a),H=m.isString(l)?x(l,!0):l;Math.ceil(n.current.scrollTop)+H>=p-s&&(m.isUndefined(e)?e=[t,p]:p>e[1]&&(e=[t,p]))}m.isArray(h)&&r(h)})};r(A);const o=e?e[0]:null;if(P(o),o){const c=f.current.querySelector(`[data-l-href="${o}"]`).getBoundingClientRect(),t=c.top-f.current.getBoundingClientRect().top+c.height/2;g.current.style.cssText=`opacity:1;top:${t}px;`}else g.current.style.cssText+="opacity:0;"}});Y(()=>{u()});const z=Q(u);V(n,"scroll",u,{passive:!0},z),W(j,u),i.useImperativeHandle(b,()=>({active:S,updateAnchor:u}),[S,u]);const F=s=>{var e,r;if(n.current){const o=R(n.current),c=n.current.scrollTop;window.location.hash=`#${s}`,n.current.scrollTop=c;const t=document.getElementById(s);if(t){const h=R(t),a=m.isString(l)?x(l,!0):l;(r=(e=C.current).clearTid)==null||r.call(e),C.current.clearTid=Z(n.current,{top:h-o-a,behavior:$})}}},G=(()=>{const s=(e,r=0)=>e.map(o=>{const{title:c,href:t,target:h,children:a}=o;return E(i.Fragment,{children:[_("li",{...d("anchor__link",{"anchor__link.is-active":t===S}),"data-l-href":t,children:_("a",{style:{paddingLeft:16+r*16},href:`#${t}`,target:h,onClick:p=>{p.preventDefault(),F(t),y==null||y(t,o)},children:c??t})}),a&&s(a,r+1)]},`${t}-${r}`)});return s(A)})();return E("ul",{...v,...X(d("anchor"),{className:v.className,style:v.style}),ref:f,children:[_("div",{...d("anchor__indicator-track"),children:_("div",{...d("anchor__indicator-wrapper"),ref:g,children:k===I?_("div",{...d("anchor__dot-indicator")}):k===N?_("div",{...d("anchor__line-indicator")}):k})}),G]})}const L=i.forwardRef(et);L.DOT_INDICATOR=I;L.LINE_INDICATOR=N;export{L as A};
