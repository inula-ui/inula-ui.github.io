import{o as n,i as qe,G as ht,l as R,j as l,u as mt,a as bt,b as gt,f as vt,x as St,c as xt,g as kt,d as ne,z as Et,J as wt,K as oe,L as yt,R as Ct,W as Be,M as Rt,k as It,n as Nt,p as ye,m as ae,s as Dt,e as j,I as ce,N as Tt,O as Mt,F as Lt,t as je,P as Pt,q as At,Q as Ce}from"./index-249b6286.js";import{u as Wt}from"./useForkRef-71e20439.js";import{S as zt}from"./cancel-bd11743d.js";import{S as Ft}from"./keyboard_arrow_down-644b147a.js";import{S as Ht}from"./search-b54e201a.js";import{g as de}from"./utils-c2ed83c6.js";import{T as S,M as $t,S as Ut}from"./single-node-19c90d0d.js";import{V as Vt}from"./VirtualScroll-fbeeace4.js";import{C as Ot}from"./Checkbox-461b2a38.js";import{E as Ge}from"./Empty-9c4c5720.js";import{T as Kt}from"./TreePanel-ef02329b.js";import{i as Bt}from"./isPrintableCharacter-1b5c27a6.js";import{T as Ye}from"./Tag-93ca08af.js";function jt(ue,pe){const{namespace:fe,styled:_,id:m,list:A,customItem:G,itemId:Y,itemFocused:v,multiple:U,onlyLeafSelectable:_e,virtual:W,focusVisible:q,onClick:c}=ue,d=n.useRef(null),I=n.useRef(null),J=qe(o=>{var N,x,h,D;if(d.current){let u;switch(o){case"next":u=(N=I.current)==null?void 0:N.scrollToStep(d.current,1);break;case"prev":u=(x=I.current)==null?void 0:x.scrollToStep(d.current,-1);break;case"first":u=(h=I.current)==null?void 0:h.scrollToStart(d.current);break;case"last":u=(D=I.current)==null?void 0:D.scrollToEnd(d.current);break;default:o instanceof HTMLElement&&d.current&&ht(o,d.current);break}return u}});n.useImperativeHandle(pe,()=>J,[J]);const z=n.useMemo(()=>({list:A,itemKey:o=>o.value,itemSize:R.isNumber(W)?W:32,itemFocusable:o=>o[S].enabled}),[A,W]);return l(Vt,{...z,ref:I,enable:W!==!1,listSize:264,listPadding:4,itemRender:(o,N,x)=>{const h=o[S];let D=h.checked;if(!_e){let u=h;for(;u.parent;)if(u=u.parent,u.id===o.value){D=!0;break}}return n.createElement("li",{..._("tree__option",{"tree__option.is-selected":!U&&D,"tree__option.is-disabled":h.disabled}),...x,key:o.value,id:Y(o.value),title:o.label,role:"option","aria-selected":h.checked,"aria-disabled":h.disabled,onClick:()=>{c(o)}},q&&(v==null?void 0:v.value)===o.value&&l("div",{className:`${fe}-focus-outline`}),U&&l("div",{..._("tree__option-checkbox"),children:l(Ot,{model:h.checked,disabled:h.disabled})}),l("div",{..._("tree__option-content"),children:G?G(h.origin):de(h)}))},itemFocused:v==null?void 0:v.value,placeholder:"li",children:(o,N)=>l("ul",{..._("tree"),ref:d,id:m,tabIndex:-1,role:"listbox","aria-multiselectable":U,"aria-activedescendant":R.isUndefined(v)?void 0:Y(v.value),onScroll:N,children:A.length===0?l(Ge,{style:{padding:"12px 28px"},image:Ge.SIMPLE_IMG}):o})})}const Gt=n.forwardRef(jt),Yt={"tree-select":"^tree-select","tree-select.is-expanded":"is-expanded","tree-select.is-disabled":"is-disabled","tree-select--small":"^tree-select--small","tree-select--medium":"^tree-select--medium","tree-select--large":"^tree-select--large","tree-select__container":"^tree-select__container","tree-select__content":"^tree-select__content","tree-select__search":"^tree-select__search","tree-select__placeholder-wrapper":"^tree-select__placeholder-wrapper","tree-select__placeholder":"^tree-select__placeholder","tree-select__multiple-count":"^tree-select__multiple-count","tree-select__close":"^tree-select__close","tree-select__clear":"^tree-select__clear","tree-select__icon":"^tree-select__icon","tree-select__arrow":"^tree-select__arrow","tree-select-popup":"^tree-select-popup","tree-select-popup__content":"^tree-select-popup__content","tree-select-popup__loading":"^tree-select-popup__loading","tree-select-popup__loading--empty":"^tree-select-popup__loading--empty",tree:"^tree","tree--line":"^tree--line",tree__group:"^tree__group","tree__group--root":"^tree__group--root",tree__option:"^tree__option","tree__option.is-selected":"is-selected","tree__option.is-disabled":"is-disabled","tree__option--root":"^tree__option--root","tree__option--first":"^tree__option--first","tree__option-dot":"^tree__option-dot","tree__option-icon":"^tree__option-icon","tree__option-arrow":"^tree__option-arrow","tree__option-arrow.is-expand":"is-expand","tree__option-checkbox":"^tree__option-checkbox","tree__option-content":"^tree__option-content",tree__empty:"^tree__empty"};function qt(ue,pe){const{styleOverrides:fe,styleProvider:_,formControl:m,list:A,model:G,defaultModel:Y,expands:v,defaultExpands:U,visible:_e,defaultVisible:W,placeholder:q,multiple:c=!1,searchable:d=!1,searchValue:I,defaultSearchValue:J,onlyLeafSelectable:z=!0,showLine:o=!1,clearable:N=!1,loading:x=!1,size:h,disabled:D=!1,virtual:u=!1,escClosable:Je=!0,customItem:Re,customSelected:F,customSearch:T,inputRef:Qe,inputRender:Ie,popupRender:Ne,onModelChange:he,onFirstExpand:me,onExpandsChange:De,onVisibleChange:Ze,onSearch:Xe,onClear:be,afterVisibleChange:H,onScrollBottom:et,...b}=mt("TreeSelect",ue),M=bt(),p=gt(Yt,{"tree-select":_==null?void 0:_["tree-select"],tree:_==null?void 0:_.tree,"tree-select-popup":_==null?void 0:_["tree-select-popup"]},fe),Q=vt(),Te=n.useRef({expands:new Set}),{t:Me}=St(),Le=xt(),ge=`${M}-tree-select-list-${Le}`,ve=e=>`${M}-tree-select-item-${e}-${Le}`,{pageScrollRef:tt,contentResizeRef:st}=kt(),V=n.useRef(null),L=n.useRef(null),Z=n.useRef(null),rt=Wt(Z,Qe),O=n.useRef(null),[K,w]=n.useMemo(()=>{const e=A.map(i=>c?new $t(i,s=>s.value,{disabled:i.disabled}):new Ut(i,s=>s.value,{disabled:i.disabled})),t=new Map,r=i=>{for(const s of i)t.set(s.id,s),s.children&&r(s.children)};return r(e),[e,t]},[A,c]),[f,k]=ne(W??!1,_e,Ze),[X,it]=ne(J??"",I,Xe),[ee,y]=ne(Y??(c?[]:null),G,e=>{he&&(c?he(e,e.map(t=>w.get(t).origin)):he(e,R.isNull(e)?null:w.get(e).origin))},void 0,m==null?void 0:m.control),g=n.useMemo(()=>c?new Set(ee):ee,[ee,c]),Pe=e=>{if(c){const t=e.changeStatus(e.checked?"UNCHECKED":"CHECKED",g);y(Array.from(t.keys()))}else(e.isLeaf||!z)&&y(e.id),e.isLeaf&&k(!1)},Ae=e=>{if(c){const t=e[S].changeStatus(e[S].checked?"UNCHECKED":"CHECKED",g);y(Array.from(t.keys()))}else y(e[S].id),k(!1)};w.forEach(e=>{e.updateStatus(g)});const[We,ze]=ne(U??[],v,e=>{De&&De(e,e.map(t=>w.get(t).origin))}),te=n.useMemo(()=>new Set(We),[We]),{size:Se,disabled:$}=Et({size:h,disabled:D||(m==null?void 0:m.control.disabled)}),E=X.length>0,se=c?g.size>0:!R.isNull(g),re=(()=>{if(!E)return[];const e=R.isUndefined(T==null?void 0:T.filter)?s=>s.label.includes(X):s=>T.filter(X,s),t=T==null?void 0:T.sort,r=[],i=s=>{s.forEach(a=>{(!c&&!z||a.isLeaf)&&e(a.origin)&&r.push({label:de(a),value:a.id,disabled:a.disabled,[S]:a}),a.children&&i(a.children)})};return i(K),t&&r.sort((s,a)=>t(s[S].origin,a[S].origin)),r})(),Fe=E?re.length===0:K.length===0,[He,lt]=wt(e=>e.startsWith("Arrow")||["Home","End","Enter","Space"].includes(e)),[$e,Ue]=n.useState(),xe=(()=>{let e;return $e&&(e=w.get($e.id),e&&e.enabled)||(se&&(e=oe(K,t=>t.enabled&&t.checked,t=>te.has(t.id)&&t.children)),R.isUndefined(e)&&(e=oe(K,t=>t.enabled,t=>te.has(t.id)&&t.children))),e})(),[ke,Ve]=n.useState(),Ee=(()=>{if(ke&&oe(re,e=>e[S].enabled&&e.value===ke.value))return ke;if(E)return oe(re,e=>e[S].enabled)})(),nt=yt(f),ot=`calc(var(--${M}-zindex-fixed) + ${nt})`,we=n.useRef(),C=qe(()=>{if(f&&V.current&&L.current){const e=V.current.offsetWidth,t=L.current.offsetHeight,r=Ct.windowSize.width-Be*2,i=Math.min(L.current.scrollWidth,r),s=Rt(V.current,{width:i,height:t},{placement:"bottom-left",inWindow:Be});we.current=s.transformOrigin,Q.classes.position&&L.current.classList.toggle(Q.classes.position,!1),Q.replaceRule("position",{top:s.top,left:s.left,minWidth:Math.min(e,r),maxWidth:r}),L.current.classList.toggle(Q.classes.position,!0)}}),at=It(C,!f);Nt(tt,"scroll",C,{passive:!0},!f||at),ye(V,C,void 0,!f),ye(L,C,void 0,!f),ye(st,C,void 0,!f),n.useImperativeHandle(pe,()=>({updatePosition:C}),[C]);const ie=e=>{document.activeElement===Z.current&&e.target!==Z.current&&e.button===0&&e.preventDefault()},ct=e=>{const t=te.has(e.id);e.origin.loading||(t?ze(r=>{r.splice(r.findIndex(i=>i===e.id),1)}):(Te.current.expands.has(e.id)||(Te.current.expands.add(e.id),me==null||me(e.id,e.origin)),ze(r=>{r.push(e.id)})))},P=n.useRef(),le=d&&f,Oe=N&&se&&!f&&!x&&!$,Ke=lt(n.createElement(d?"input":"div",Object.assign({...ae(p("tree-select__search"),{style:{opacity:le?void 0:0,zIndex:le?void 0:-1}}),...m==null?void 0:m.inputAria,ref:rt,tabIndex:$?-1:0,role:"combobox","aria-haspopup":"listbox","aria-expanded":f,"aria-controls":ge,onBlur:()=>{k(!1)},onKeyDown:e=>{if(e.code==="Escape")f&&Je&&(e.stopPropagation(),e.preventDefault(),k(!1));else{const t=r=>{if(O.current){const i=O.current(r);i&&(E?Ve(i):Ue(i),u===!1&&!r.includes("level")&&(P.current=()=>{const s=document.getElementById(ve(E?i.value:i.id));s&&O.current(s)},f&&(P.current(),P.current=void 0)))}};if(f)switch(e.code){case"ArrowUp":{e.preventDefault(),t("prev");break}case"ArrowDown":{e.preventDefault(),t("next");break}case"ArrowLeft":{E||(e.preventDefault(),t("prev-level"));break}case"ArrowRight":{E||(e.preventDefault(),t("next-level"));break}case"Home":{e.preventDefault(),t("first");break}case"End":{e.preventDefault(),t("last");break}default:{(e.code==="Enter"||e.code==="Space"&&!d)&&(e.preventDefault(),E?Ee&&Ae(Ee):xe&&Pe(xe));break}}else if(!(d&&["Home","End","Enter","Space"].includes(e.code)))switch(e.code){case"End":case"ArrowUp":{e.preventDefault(),k(!0),t("last");break}case"Home":case"ArrowDown":{e.preventDefault(),k(!0),t("first");break}case"Enter":case"Space":{e.preventDefault(),k(!0);break}default:{Bt(e.key)&&k(!0);break}}}},onChange:e=>{d&&it(e.currentTarget.value)}},d?{type:"text",value:X,autoComplete:"off",disabled:$}:{}))),[dt,ut,pt]=(()=>{let e=null,t=null,r;if(c){const i=[];for(const s of ee){const a=w.get(s);a&&i.push(a)}t=l(Dt,{list:i.map(s=>{const{value:a,disabled:B}=s.origin,_t=F?F(s.origin):de(s);return{id:a,title:_t,type:"item",disabled:B,node:s}}),onClick:(s,a)=>{const B=a.node.changeStatus("UNCHECKED",g);return y(Array.from(B.keys())),!1},children:l(Ye,{tabIndex:-1,size:Se,children:g.size})}),e=i.map(s=>j(Ye,{size:Se,children:[F?F(s.origin):s.origin.label,!(s.disabled||$)&&l("div",{...p("tree-select__close"),role:"button","aria-label":Me("Close"),onClick:a=>{a.stopPropagation();const B=s.changeStatus("UNCHECKED",g);y(Array.from(B.keys()))},children:l(ce,{children:l(Tt,{})})})]},s.id))}else if(!R.isNull(g)){const i=w.get(g);i&&(r=de(i),e=F?F(i.origin):r)}return[e,t,r]})(),ft=Mt({compose:{disabled:$},form:m});return j(Lt,{children:[j("div",{...b,...ae(p("tree-select",`tree-select--${Se}`,{"tree-select.is-expanded":f,"tree-select.is-disabled":$}),{className:b.className,style:b.style}),...ft,ref:V,onMouseDown:e=>{var t;(t=b.onMouseDown)==null||t.call(b,e),ie(e)},onMouseUp:e=>{var t;(t=b.onMouseUp)==null||t.call(b,e),ie(e)},onClick:e=>{var t,r;(t=b.onClick)==null||t.call(b,e),(r=Z.current)==null||r.focus({preventScroll:!0}),k(i=>d?!0:!i)},children:[j("div",{...p("tree-select__container"),title:pt,children:[Ie?Ie(Ke):Ke,!le&&(se?l("div",{...p("tree-select__content"),children:dt}):q?l("div",{...p("tree-select__placeholder-wrapper"),children:l("div",{...p("tree-select__placeholder"),children:q})}):null)]}),c&&l("div",{...p("tree-select__multiple-count"),onClick:e=>{e.stopPropagation()},children:ut}),Oe&&l("div",{...p("tree-select__clear"),role:"button","aria-label":Me("Clear"),onClick:e=>{e.stopPropagation(),be==null||be(),y(c?[]:null)},children:l(ce,{children:l(zt,{})})}),l("div",{...ae(p("tree-select__icon"),{style:{visibility:Oe?"hidden":void 0}}),children:l(ce,{children:x?l(je,{}):le?l(Ht,{}):l(Ft,{...p("tree-select__arrow")})})})]}),l(Pt,{selector:()=>{let e=document.getElementById(`${M}-tree-select-root`);return e||(e=document.createElement("div"),e.id=`${M}-tree-select-root`,document.body.appendChild(e)),e},children:l(At,{enter:f,during:Ce,afterRender:()=>{var e;C(),(e=P.current)==null||e.call(P),P.current=void 0},afterEnter:()=>{H==null||H(!0)},afterLeave:()=>{H==null||H(!1)},children:e=>{let t={};switch(e){case"enter":t={transform:"scaleY(0.7)",opacity:0};break;case"entering":t={transition:["transform","opacity"].map(r=>`${r} ${Ce}ms ease-out`).join(", "),transformOrigin:we.current};break;case"leaving":t={transform:"scaleY(0.7)",opacity:0,transition:["transform","opacity"].map(r=>`${r} ${Ce}ms ease-in`).join(", "),transformOrigin:we.current};break;case"leaved":t={display:"none"};break}return l("div",{...ae(p("tree-select-popup"),{style:{zIndex:ot,...t}}),ref:L,onMouseDown:r=>{ie(r)},onMouseUp:r=>{ie(r)},children:(()=>{const r=j("div",{...p("tree-select-popup__content"),children:[x&&l("div",{...p("tree-select-popup__loading",{"tree-select-popup__loading--empty":Fe}),children:l(ce,{children:l(je,{})})}),x&&Fe?null:E?l(Gt,{ref:O,namespace:M,styled:p,id:ge,list:re,customItem:Re,itemId:ve,itemFocused:Ee,multiple:c,onlyLeafSelectable:z,virtual:u,focusVisible:He,onClick:i=>{Ve(i),Ae(i)}}):l(Kt,{style:{maxHeight:264,padding:"4px 0"},ref:O,id:ge,namespace:M,styled:p,list:K,itemId:ve,itemSelected:!c&&se?w.get(g):void 0,itemFocused:xe,expands:te,customItem:Re,showLine:o,multiple:c,onlyLeafSelectable:z,disabled:!1,virtual:u===!1?void 0:{listSize:264,listPadding:4,itemSize:R.isNumber(u)?u:32},focusVisible:He,onNodeFocus:Ue,onNodeExpand:ct,onNodeClick:Pe,onScrollBottom:et})]});return Ne?Ne(r):r})()})}})})]})}const cs=n.forwardRef(qt);export{cs as T};
